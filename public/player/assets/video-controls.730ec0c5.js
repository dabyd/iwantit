import{G as n}from"./goldComponent.e5e22987.js";import a from"./hot-points.5049d712.js";import"./player.5a295e80.js";class h extends n{constructor(e,t,i,s=void 0){super(e,t,i,s),this._addNodesToDomMap({VIDEO_INSTANCE:document.querySelector(".video")}),this._addNodesToDomMap({PLAY_PAUSE_CONTROL:document.querySelector(".play-pause")}),this._addNodesToDomMap({PLAY_PAUSE_CENTERED_CONTROL:document.querySelector(".iwt-centered-play-pause")}),this._addNodesToDomMap({FULL_SCREEN_CONTROL:document.querySelector(".full-screen")}),this._addNodesToDomMap({VOLUME_CONTROL:document.querySelector(".volume")}),this._addNodesToDomMap({VOLUME_RANGE_CONTROL:document.querySelector(".volume-range")}),this._addNodesToDomMap({VOLUME_PROGRESS_BAR:document.querySelector(".iwt-volume-progress-bar")}),this._addNodesToDomMap({SHOP_BAG_CONTROL:document.querySelector(".shop-bag")}),this._addNodesToDomMap({PROGRESS_CONTROL:document.querySelector(".progress")}),this._addNodesToDomMap({PROGRESS_BAR:document.querySelector(".progress-bar")}),this._addNodesToDomMap({TIME_CURRENT:document.querySelector(".iwt-time-current")}),this._addNodesToDomMap({TIME_DURATION:document.querySelector(".iwt-time-duration")}),this._currentProjectId=void 0,this._currentKey=void 0}whenTheBehaviourIsFullyLoaded(){super.whenTheBehaviourIsFullyLoaded(),this._notifiesThatInteractionWithTheUserIsAvailable()}whenInteractivityWithTheUserIsAllowed(){super.whenInteractivityWithTheUserIsAllowed(),this._init()}_init(){this._enableAppUI=!1,this._resetVideoDuration(),this._initKeyboardFocusControl(),this._initMonitorForUserActivity(),this._initPlayPauseControl(),this._initFullScreenControl(),this._initVolumeControl(),this._initVolumeRangeControl(),this._initShopBagControl(),this._initProgressControl(),this._initExternalEventsHandlers()}_initKeyboardFocusControl(){this._keyboardFocusHandler=this._keyboardFocusHandler.bind(this),document.querySelectorAll(".iwt-control").forEach(e=>e.addEventListener("focus",this._keyboardFocusHandler)),document.querySelectorAll("[type='range']").forEach(e=>e.addEventListener("focus",this._keyboardFocusHandler))}_keyboardFocusHandler(e){document.querySelector(".iwt-content").classList.add("iwtmdf-visible-controls")}_initMonitorForUserActivity(){this._lastInteraction,this._monitorForUserActivityHandler=this._monitorForUserActivityHandler.bind(this),window.addEventListener("mousemove",this._monitorForUserActivityHandler),window.addEventListener("click",this._monitorForUserActivityHandler),window.addEventListener("keyup",this._monitorForUserActivityHandler),setInterval(()=>{const e=Date.now();this._lastInteraction&&e-this._lastInteraction>5e3&&(this._lastInteraction=e,document.querySelector(".iwt-content").classList.remove("iwtmdf-visible-controls"),document.querySelector("body").style.cursor="none")},1e3)}_monitorForUserActivityHandler(e){this._lastInteraction=Date.now(),document.querySelector(".iwt-content").classList.add("iwtmdf-visible-controls"),document.querySelector("body").style.cursor=""}_showVideoDuration(){let e=setInterval(t=>{this._getDomMapNode("VIDEO_INSTANCE").readyState===4&&(this._getDomMapNode("TIME_DURATION").textContent=this._returnTime(this._getDomMapNode("VIDEO_INSTANCE").duration),clearInterval(e))},500)}_resetVideoDuration(){this._getDomMapNode("TIME_DURATION").textContent="--:--:--"}_initExternalEventsHandlers(){this._newProjectEventHandler=this._newProjectEventHandler.bind(this),this._eventEmitter.on("NEW_PROJECT",this._newProjectEventHandler),this._newKeyEventHandler=this._newKeyEventHandler.bind(this),this._eventEmitter.on("NEW_KEY",this._newKeyEventHandler)}_newProjectEventHandler(e){this._currentProjectId=e.currentProjectId,this._resetControls(),this._spinnerEnabled=!0,this._canplayHandler=this._canplayHandler.bind(this),this._getDomMapNode("VIDEO_INSTANCE").addEventListener("canplay",this._canplayHandler)}_newKeyEventHandler(e){this._currentKey=e.currentKey}_canplayHandler(e){this._enableAppUI=!0,this._spinnerEnabled=!1,this._initProgressControl(),this._showVideoDuration(),this._getDomMapNode("VIDEO_INSTANCE").removeEventListener("canplay",this._canplayHandler)}_resetControls(){this._enableAppUI=!1,this._shopEnabled&&(this._endShopProcess(),this._enableOrDisableShopProcessState()),this._resetVideoDuration(),this._finalizeProgressControl(),this._finalizePlayPauseControl()}set _spinnerEnabled(e){const t=document.documentElement.classList;e?t.add("iwtmdf-show-spinner"):t.remove("iwtmdf-show-spinner")}_initPlayPauseControl(){this.mainContainer.classList.add("iwtmdf-paused"),this._playPauseControlHandler=this._playPauseControlHandler.bind(this),this._getDomMapNode("PLAY_PAUSE_CONTROL").addEventListener("click",this._playPauseControlHandler),this._getDomMapNode("PLAY_PAUSE_CENTERED_CONTROL").addEventListener("click",this._playPauseControlHandler),this._getDomMapNode("PLAY_PAUSE_CONTROL").addEventListener("blur",this._playPauseControlHandler),this._getDomMapNode("VIDEO_INSTANCE").addEventListener("ended",this._playPauseControlHandler)}_playPauseControlHandler(e){if(e.type==="ended"){this._finalizePlayPauseControl();return}if(e.currentTarget!==this._getDomMapNode("PLAY_PAUSE_CENTERED_CONTROL")){if(e.type==="blur"){this._getDomMapNode("PLAY_PAUSE_CONTROL").classList.remove("iwtmdf-not-focusable"),this._getDomMapNode("PLAY_PAUSE_CONTROL").blur();return}e.type==="click"&&e.detail>0&&this._getDomMapNode("PLAY_PAUSE_CONTROL").classList.add("iwtmdf-not-focusable")}else{const t=i=>{i.currentTarget.classList.remove("iwtanm-zoom"),i.currentTarget.removeEventListener("animationend",t)};this._getDomMapNode("PLAY_PAUSE_CONTROL").classList.add("iwtanm-zoom"),this._getDomMapNode("PLAY_PAUSE_CONTROL").addEventListener("animationend",t)}this._getDomMapNode("VIDEO_INSTANCE").paused?(this.mainContainer.classList.remove("iwtmdf-paused"),this.mainContainer.classList.add("iwtmdf-playing"),this._getDomMapNode("VIDEO_INSTANCE").play(),this._shopEnabled&&(this._hotpoints.end(),this._hotpoints=null,this._shopEnabled=!1)):(this.mainContainer.classList.remove("iwtmdf-playing"),this.mainContainer.classList.add("iwtmdf-paused"),this._getDomMapNode("VIDEO_INSTANCE").pause()),this._shopLayerEnabled=!1}_finalizePlayPauseControl(){this.mainContainer.classList.remove("iwtmdf-playing"),this.mainContainer.classList.add("iwtmdf-paused"),this._getDomMapNode("VIDEO_INSTANCE").pause(),this._getDomMapNode("PROGRESS_CONTROL").value=this._getDomMapNode("PROGRESS_BAR").value=0,this._getDomMapNode("TIME_CURRENT").textContent=this._returnTime(0)}_initShopBagControl(){this._shopEnabled=!1,this._stateVideoBeforeShop="paused",this._shopBagControlHandler=this._shopBagControlHandler.bind(this),this._getDomMapNode("SHOP_BAG_CONTROL").addEventListener("click",this._shopBagControlHandler)}_shopBagControlHandler(e){this._enableOrDisableShopProcessState()?this._startShopProcess():this._endShopProcess()}_enableOrDisableShopProcessState(){return this.mainContainer.classList.contains("iwtmdf-shop-active")?this._stateVideoBeforeShop==="playing"&&!this._apiError&&(this.mainContainer.classList.remove("iwtmdf-paused"),this.mainContainer.classList.add("iwtmdf-playing"),this._getDomMapNode("VIDEO_INSTANCE").play()):(this._stateVideoBeforeShop=this._getDomMapNode("VIDEO_INSTANCE").paused?"paused":"playing",this.mainContainer.classList.remove("iwtmdf-playing"),this.mainContainer.classList.add("iwtmdf-paused"),this._getDomMapNode("VIDEO_INSTANCE").pause()),this._shopEnabled=this._shopLayerEnabled=!this.mainContainer.classList.contains("iwtmdf-shop-active"),this._shopEnabled}set _shopLayerEnabled(e){e?this.mainContainer.classList.add("iwtmdf-shop-active"):this.mainContainer.classList.remove("iwtmdf-shop-active")}_startShopProcess(){this._apiError=!1;const e=this._getDomMapNode("VIDEO_INSTANCE").currentTime.toFixed(1);this._hotpoints=new a(this.eventEmitter,e,this._currentKey,this._currentProjectId),this._hotpointsErrorHandler=this._hotpointsErrorHandler.bind(this),this._eventEmitter.on("API_GET_ERROR",this._hotpointsErrorHandler),this._hotpoints.start()}_endShopProcess(){this._hotpoints&&(this._eventEmitter.removeListener("API_GET_ERROR",this._hotpointsErrorHandler),this._hotpoints.end(),this._hotpoints=null)}_hotpointsErrorHandler(e){this._apiError=!0,this._endShopProcess(),this._enableOrDisableShopProcessState()}_initFullScreenControl(){this.mainContainer.classList.add("iwtmdf-windowed"),this._fullScreenChangeHandler=this._fullScreenChangeHandler.bind(this),document.addEventListener("fullscreenchange",this._fullScreenChangeHandler),this._fullScreenControlHandler=this._fullScreenControlHandler.bind(this),this._getDomMapNode("FULL_SCREEN_CONTROL").addEventListener("click",this._fullScreenControlHandler),this._getDomMapNode("FULL_SCREEN_CONTROL").addEventListener("blur",this._fullScreenControlHandler)}_fullScreenChangeHandler(e){document.fullscreenElement||(this.mainContainer.classList.remove("iwtmdf-full-screen"),this.mainContainer.classList.add("iwtmdf-windowed"))}_fullScreenControlHandler(e){if(e.type==="blur"){this._getDomMapNode("FULL_SCREEN_CONTROL").classList.remove("iwtmdf-not-focusable"),this._getDomMapNode("FULL_SCREEN_CONTROL").blur();return}e.type==="click"&&e.detail>0&&this._getDomMapNode("FULL_SCREEN_CONTROL").classList.add("iwtmdf-not-focusable"),document.fullscreenElement?(this.mainContainer.classList.remove("iwtmdf-full-screen"),this.mainContainer.classList.add("iwtmdf-windowed"),document.exitFullscreen()):(this.mainContainer.classList.remove("iwtmdf-windowed"),this.mainContainer.classList.add("iwtmdf-full-screen"),document.documentElement.requestFullscreen())}_initVolumeControl(){this._getDomMapNode("VOLUME_RANGE_CONTROL").addEventListener("input",e=>{this._getDomMapNode("VIDEO_INSTANCE").volume=this._getDomMapNode("VOLUME_RANGE_CONTROL").value/100}),this.mainContainer.classList.add("iwtmdf-volume-low"),this._videoMuted=!1,this._volume=.5,this._setVolume(this._volume),this._volumeMuteHandler=this._volumeMuteHandler.bind(this),this._getDomMapNode("VOLUME_CONTROL").addEventListener("click",this._volumeMuteHandler),this._getDomMapNode("VOLUME_CONTROL").addEventListener("blur",this._volumeMuteHandler)}_volumeMuteHandler(e){if(e.type==="blur"){this._getDomMapNode("VOLUME_CONTROL").classList.remove("iwtmdf-not-focusable"),this._getDomMapNode("VOLUME_CONTROL").blur();return}e.type==="click"&&e.detail>0&&this._getDomMapNode("VOLUME_CONTROL").classList.add("iwtmdf-not-focusable"),this._getDomMapNode("VIDEO_INSTANCE").volume>0?(this._volume=this._getDomMapNode("VIDEO_INSTANCE").volume,this._setVolume(0),this.mainContainer.classList.remove("iwtmdf-volume-low"),this.mainContainer.classList.remove("iwtmdf-volume-high"),this.mainContainer.classList.add("iwtmdf-volume-mute")):this._volume!==0&&(this._setVolume(this._volume),this.mainContainer.classList.remove("iwtmdf-volume-mute"),this._getDomMapNode("VIDEO_INSTANCE").volume<.5?(this.mainContainer.classList.add("iwtmdf-volume-low"),this.mainContainer.classList.remove("iwtmdf-volume-high")):(this.mainContainer.classList.remove("iwtmdf-volume-low"),this.mainContainer.classList.add("iwtmdf-volume-high")))}_setVolume(e){this._getDomMapNode("VIDEO_INSTANCE").volume=e,this._getDomMapNode("VOLUME_RANGE_CONTROL").value=e*100}_initVolumeRangeControl(){this._getDomMapNode("VOLUME_PROGRESS_BAR").value=50,this._volumeRangeControlHandler=this._volumeRangeControlHandler.bind(this),this._getDomMapNode("VOLUME_RANGE_CONTROL").addEventListener("input",this._volumeRangeControlHandler),this._getDomMapNode("VOLUME_RANGE_CONTROL").addEventListener("blur",this._volumeRangeControlHandler)}_volumeRangeControlHandler(e){if(e.type==="blur"){this._getDomMapNode("VOLUME_RANGE_CONTROL").classList.remove("iwtmdf-not-focusable"),this._getDomMapNode("VOLUME_RANGE_CONTROL").blur();return}e.type==="input"&&this._getDomMapNode("VOLUME_RANGE_CONTROL").classList.add("iwtmdf-not-focusable"),this._volume=this._getDomMapNode("VIDEO_INSTANCE").volume=this._getDomMapNode("VOLUME_RANGE_CONTROL").value/100,this._getDomMapNode("VOLUME_PROGRESS_BAR").value=this._getDomMapNode("VOLUME_RANGE_CONTROL").value,this._volume===0?(this._volume=this._getDomMapNode("VIDEO_INSTANCE").volume,this.mainContainer.classList.remove("iwtmdf-volume-low"),this.mainContainer.classList.remove("iwtmdf-volume-high"),this.mainContainer.classList.add("iwtmdf-volume-mute")):(this.mainContainer.classList.remove("iwtmdf-volume-mute"),this._getDomMapNode("VIDEO_INSTANCE").volume<.5?(this.mainContainer.classList.add("iwtmdf-volume-low"),this.mainContainer.classList.remove("iwtmdf-volume-high")):(this.mainContainer.classList.remove("iwtmdf-volume-low"),this.mainContainer.classList.add("iwtmdf-volume-high")))}_initProgressControl(){this._getDomMapNode("PROGRESS_CONTROL").value=this._getDomMapNode("PROGRESS_BAR").value=0,this._progressControlHandler=this._progressControlHandler.bind(this),this._timeUpdateHandler=this._timeUpdateHandler.bind(this),this._getDomMapNode("PROGRESS_CONTROL").addEventListener("input",this._progressControlHandler),this._getDomMapNode("PROGRESS_CONTROL").addEventListener("blur",this._progressControlHandler),this._getDomMapNode("VIDEO_INSTANCE").addEventListener("timeupdate",this._timeUpdateHandler),this._getDomMapNode("VIDEO_INSTANCE").addEventListener("waiting",e=>this._spinnerEnabled=!0),this._getDomMapNode("VIDEO_INSTANCE").addEventListener("canplay",e=>this._spinnerEnabled=!1)}_finalizeProgressControl(){this._getDomMapNode("PROGRESS_CONTROL").value=this._getDomMapNode("PROGRESS_BAR").value=0,this._getDomMapNode("PROGRESS_CONTROL").removeEventListener("input",this._progressControlHandler),this._getDomMapNode("PROGRESS_CONTROL").removeEventListener("blur",this._progressControlHandler),this._getDomMapNode("VIDEO_INSTANCE").removeEventListener("timeupdate",this._timeUpdateHandler),this._getDomMapNode("VIDEO_INSTANCE").removeEventListener("waiting",e=>this._spinnerEnabled=!0),this._getDomMapNode("VIDEO_INSTANCE").removeEventListener("canplay",e=>this._spinnerEnabled=!1)}_progressControlHandler(e){if(e.type==="blur"){this._getDomMapNode("PROGRESS_CONTROL").classList.remove("iwtmdf-not-focusable"),this._getDomMapNode("PROGRESS_CONTROL").blur();return}e.type==="input"&&this._getDomMapNode("PROGRESS_CONTROL").classList.add("iwtmdf-not-focusable");const t=this._getDomMapNode("VIDEO_INSTANCE").duration*(this._getDomMapNode("PROGRESS_CONTROL").value/100);this._getDomMapNode("VIDEO_INSTANCE").currentTime=t}_timeUpdateHandler(e){const t=100/this._getDomMapNode("VIDEO_INSTANCE").duration*this._getDomMapNode("VIDEO_INSTANCE").currentTime;this._getDomMapNode("PROGRESS_CONTROL").value=this._getDomMapNode("PROGRESS_BAR").value=Math.floor(t),this._getDomMapNode("TIME_CURRENT").textContent=this._returnTime(this._getDomMapNode("VIDEO_INSTANCE").currentTime)}_returnTime(e){let t=Math.floor(e/3600);t<10&&(t=`0${t}`);let i=Math.floor(e/60)%60;i<10&&(i=`0${i}`);let s=Math.floor(e%60);s<10&&(s=`0${s}`);let o=(e%60).toFixed(2).split(".")[1];return`${t}:${i}:${s}.${o}`}set _enableAppUI(e){const t=document.documentElement.classList;e?t.remove("iwtmdf-ui-disabled"):t.add("iwtmdf-ui-disabled")}destroy(){super.destroy()}}export{h as default};
