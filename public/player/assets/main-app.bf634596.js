import{G as r}from"./goldComponent.e5e22987.js";import{e as n}from"./player.5a295e80.js";class d{constructor(){this._API_URL=env.SERVER.URL_API,this._action="get_projects",this._receivedData=void 0}async go(){this._controller=new AbortController,this._receivedData=await this._callIWantItAPI()}abort(){this._controller&&this._controller.abort(!0)}end(){this._receivedData=void 0,this.abort()}getProjectsIterator(){let e=0;return{next:t=>e<this._receivedData.length?{value:this._receivedData[e++],done:!1}:{done:!0}}}getProjectFileURL(e){return this._receivedData?this._receivedData.find(o=>o.id==e).url:void 0}getProjectTitle(e){return this._receivedData?this._receivedData.find(o=>o.id==e).name:void 0}_callIWantItAPI(){return this._request=new Request(`${this._API_URL}?action=${this._action}`,{signal:this._controller.signal}),fetch(this._request).then(e=>e.status===200?e.json():{error:"An error occurred while trying to access the I Want It servers. Please try in a few minutes."})}}class c extends r{constructor(e,t,o,s=void 0){super(e,t,o,s),this._URL_VIDEOS=n.SERVER.URL_PUBLIC,this._currentProjectId=this._provisionalProjectID=this._currentKey=void 0,this._addNodesToDomMap({SELECTORS_BUTTON:document.querySelector(".iwt-selectors-button")}),this._addNodesToDomMap({PROJECT_TITLE:document.querySelector(".iwt-selectors-button-project")}),this._addNodesToDomMap({SELECTORS_MODAL:document.getElementById("iwt-selectors-modal")}),this._addNodesToDomMap({SELECTORS_MODAL_CLOSE_BUTTON:document.querySelector(".iwt-selectors-modal-close")}),this._addNodesToDomMap({SELECTORS_MODAL_OKEY_BUTTON:document.querySelector(".iwt-selectors-modal-okey")}),this._addNodesToDomMap({SELECTORS_MODAL_FILE_BUTTON:document.getElementById("iwt-key-input")}),this._addNodesToDomMap({SELECTORS_PROJECT_SELECT:document.getElementById("iwt-project-select")}),this._addNodesToDomMap({SELECTORS_PROJECT_SELECT_WRAPPER:document.querySelector(".iwt-project-select-wrapper")}),this._addNodesToDomMap({VIDEO_SOURCE:document.querySelector(".iwt-video source")}),this._addNodesToDomMap({VIDEO:document.querySelector(".iwt-video video")})}whenTheBehaviourIsFullyLoaded(){super.whenTheBehaviourIsFullyLoaded(),this._notifiesThatInteractionWithTheUserIsAvailable()}whenInteractivityWithTheUserIsAllowed(){super.whenInteractivityWithTheUserIsAllowed(),this._selectorsButtonHandler=this._selectorsButtonHandler.bind(this),this._getDomMapNode("SELECTORS_BUTTON").addEventListener("click",this._selectorsButtonHandler),this._selectorButtonEnabled=!1,this._checkURL()}_selectorsButtonHandler(e){this._openSelectorsModal()}whenMakeupIsAllowed(){super.whenMakeupIsAllowed()}async _checkURL(){(this._currentProjectId=this._provisionalProjectID=this._getsTheIdParameterFromTheURL())?(this._spinnerEnabled=!0,await this._startService(),this._spinnerEnabled=!1,this._setProjectTitle(this._projectsService.getProjectTitle(this._currentProjectId)),this._loadVideo(),this._selectorButtonEnabled=!0,this._eventEmitter.emit("NEW_PROJECT",{currentProjectId:this._currentProjectId})):(this._setProjectTitle("No project was selected. Please select one."),this._noFirstLoadProjectEnabled=!0)}_getsTheIdParameterFromTheURL(){return new URL(window.location.href).searchParams.get("id")}_loadVideo(){const e=this._projectsService.getProjectFileURL(this._currentProjectId);this._getDomMapNode("VIDEO_SOURCE").src=`${this._URL_VIDEOS}${e}`,this._getDomMapNode("VIDEO").load(),this._getDomMapNode("VIDEO").pause(),this._selectorButtonEnabled=!0}set _spinnerEnabled(e){const t=document.documentElement.classList;e?t.add("iwtmdf-show-spinner"):t.remove("iwtmdf-show-spinner")}set _noFirstLoadProjectEnabled(e){this._noFirstLoadProject=e,e?document.documentElement.classList.add("iwtmdf-no-project"):document.documentElement.classList.remove("iwtmdf-no-project")}set _selectorButtonEnabled(e=!0){e?this._getDomMapNode("SELECTORS_BUTTON").classList.remove("iwtmdf-disabled"):this._getDomMapNode("SELECTORS_BUTTON").classList.add("iwtmdf-disabled")}set _optionSelected(e){const o=Array.from(this._getDomMapNode("SELECTORS_PROJECT_SELECT").querySelectorAll("option")).find(s=>s.value==e);o.selected=!0}set _modalOpened(e){const t=document.documentElement.classList;e?t.add("iwtmdf-modal-opened"):t.remove("iwtmdf-modal-opened")}set _enableAppUI(e){const t=document.documentElement.classList;e?t.remove("iwtmdf-ui-disabled"):t.add("iwtmdf-ui-disabled")}_getIdOptionSelected(e){return this._getDomMapNode("SELECTORS_PROJECT_SELECT").querySelectorAll("option")[e].value}_getTextOptionSelected(e){return this._getDomMapNode("SELECTORS_PROJECT_SELECT").querySelectorAll("option")[e].textContent}_setProjectTitle(e){this._getDomMapNode("PROJECT_TITLE").textContent=e}async _openSelectorsModal(){this._enableAppUI=!1,this._modalCloseButtonHandler=this._modalCloseButtonHandler.bind(this),this._getDomMapNode("SELECTORS_MODAL_CLOSE_BUTTON").addEventListener("click",this._modalCloseButtonHandler),this._modalOkeyButtonHandler=this._modalOkeyButtonHandler.bind(this),this._getDomMapNode("SELECTORS_MODAL_OKEY_BUTTON").addEventListener("click",this._modalOkeyButtonHandler),this._modalFileInputHandler=this._modalFileInputHandler.bind(this),this._getDomMapNode("SELECTORS_MODAL_FILE_BUTTON").addEventListener("change",this._modalFileInputHandler),this._optionSelectedHandler=this._optionSelectedHandler.bind(this),this._getDomMapNode("SELECTORS_PROJECT_SELECT").addEventListener("change",this._optionSelectedHandler),this._modalOpened=!0,this._getDomMapNode("SELECTORS_MODAL").showModal(),this._getDomMapNode("SELECTORS_PROJECT_SELECT_WRAPPER").classList.add("iwtmdf-loading"),await this._startService(),this._getDomMapNode("SELECTORS_PROJECT_SELECT_WRAPPER").classList.remove("iwtmdf-loading"),this._populateProjectSelect()}_readLocalFile(e){const t=new FileReader;t.readAsText(e),t.addEventListener("load",()=>{this._currentKey=t.result})}_modalFileInputHandler(e){const t=this._getDomMapNode("SELECTORS_MODAL_FILE_BUTTON").files[0];this._readLocalFile(t)}_optionSelectedHandler(e){this._currentSelectedIndex=this._getDomMapNode("SELECTORS_PROJECT_SELECT").selectedIndex,this._provisionalProjectID=this._getIdOptionSelected(this._currentSelectedIndex)}_populateProjectSelect(){this._cleanProjectSelect();const e=this._projectsService.getProjectsIterator();let t;for(;(t=e.next())!==void 0&&t.value;){const o=t.value.id,s=t.value.name;this._getDomMapNode("SELECTORS_PROJECT_SELECT").insertAdjacentHTML("beforeend",`<option value="${o}">${s}</option>`)}this._noFirstLoadProject&&(this._currentSelectedIndex=0,this._currentProjectId=this._provisionalProjectID=this._getIdOptionSelected(this._currentSelectedIndex)),this._optionSelected=this._currentProjectId}_cleanProjectSelect(){this._getDomMapNode("SELECTORS_PROJECT_SELECT").innerHTML=""}_modalOkeyButtonHandler(e){this._closeModal(),(this._noFirstLoadProject||this._provisionalProjectID!==this._currentProjectId)&&(history.replaceState(null,"","?id="+this._provisionalProjectID),this._currentProjectId=this._provisionalProjectID,this._setProjectTitle(this._getTextOptionSelected(this._currentSelectedIndex)),this._noFirstLoadProjectEnabled=!1,this._loadVideo(),this._eventEmitter.emit("NEW_PROJECT",{currentProjectId:this._currentProjectId})),this._currentKey&&this._eventEmitter.emit("NEW_KEY",{currentKey:this._currentKey})}_modalCloseButtonHandler(e){this._closeModal()}_closeModal(){this._projectsService.abort(),this._modalOpened=!1,this._enableAppUI=!0,this._getDomMapNode("SELECTORS_PROJECT_SELECT").removeEventListener("change",this._optionSelectedHandler),this._getDomMapNode("SELECTORS_MODAL_CLOSE_BUTTON").removeEventListener("click",this._modalCloseButtonHandler),this._getDomMapNode("SELECTORS_MODAL_FILE_BUTTON").removeEventListener("change",this._modalFileInputHandler),this._getDomMapNode("SELECTORS_MODAL_OKEY_BUTTON").removeEventListener("click",this._modalOkeyButtonHandler),this._getDomMapNode("SELECTORS_MODAL").close()}async _startService(){this._projectsService=new d,await this._projectsService.go()}}export{c as default};
